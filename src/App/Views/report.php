<?php
$result = $data[2];

if($result[0]['in_count'] > 0 && $_SESSION['role'] == 1) {
    $count = 'Количество ваших посещений: ' . $result[0]['in_count'];
}else {
    $count = '';
}

?>

<div class="container">
    <h5>Добро пожаловать, <? echo $result[0]['username'] ?>! <? echo $count; ?></h5>
</div>

<div class="container">
    <h4>Таблица заказов</h4>
    <div class="row">

        <div class="col s12 l3">
            <div class="row">
                <form action="" method="GET" class="col s12">
                    <h5 style="margin: 10px 0 10px 0;">Фильтры</h5>
                    <div class="row">
                        <div class="input-field col s12 m6">
                            <input placeholder="Введите месяц" type="number" class="validate" value="<?php echo $data[0]['settings']['month'] ?? '1' ?>" max="12" min="1" name="month" required>
                            <label for="first_name">Месяц</label>
                        </div>
                        <div class="input-field col s12 m6">
                            <input placeholder="Введите год" type="number" class="validate" value="<?php echo $data[0]['settings']['year'] ?? '2023' ?>" name="year" required>
                            <label for="last_name">Год</label>
                        </div>

                        <button class="btn waves-effect waves-light" type="submit">
                            Применить
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col s12 l9">
        <h5 class="center-align" style="margin: 20px 0 20px 0;">
            Сведения об исполненных заказах по гарантийному ремонту бытовой техники 
            </br> за <?php echo $data[0]['settings']['month']; ?> месяц <?php echo $data[0]['settings']['year']; ?> года
        </h5>
            <?php 

                if(isset($data[1][0])){
                    
                    foreach ($data[1] as $item) {
                        $i = 0;

                        ?>
                        <table class="striped">
                            <thead>
                                <tr>
                                    <th>Код заказа</th>
                                    <th>Ф.И.О. клиента</th>
                                    <th>Наименование товара</th>
                                    <th>Дата поступления заказа</th>
                                    <th>Дата исполнения заказа</th>
                                    <th>Срок ремонта (дней)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php 
                                
                                $result = new ReportModel;
                                $result = $result->getReportPosition($item['model']);

                                foreach ($result as $item) {
                                    echo '<tr>';
                                    echo '<td>' . $item['id'] . '</td>';
                                    echo '<td>' . $item['ФИО клиента'] . '</td>';
                                    echo '<td>' . $item['Наименование товара'] . '</td>';
                                    echo '<td>' . $item['Дата поступления заказа'] . '</td>';
                                    echo '<td>' . $item['Дата исполнения заказа'] . '</td>';
                                    echo '<td>' . $item['Срок ремонта, дней'] . '</td>';
                                    echo '</tr>';

                                    $i++;
                                }

                                ?>
                            </tbody>
                        </table>

                        <div>Наименование товара: <?php echo $item['Наименование товара'];  ?></div>
                        <div>Фирма: <?php echo $item['company']; ?></div>
                        <div>Модель: <?php echo $item['model']; ?></div>
                        <?
                        echo "<h5>Итого заказов по модели: ". $item['model']  ." : ". $i."шт.</h5>";

                    }

                } else {
                    echo '<div style="display: flex; align-items: center; flex-direction: column"><svg width="150" height="150" viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M75 46.875C69.4374 46.875 63.9997 48.5245 59.3746 51.6149C54.7494 54.7054 51.1446 59.0979 49.0159 64.2371C46.8872 69.3762 46.3302 75.0312 47.4154 80.4869C48.5006 85.9427 51.1793 90.9541 55.1126 94.8874C59.046 98.8208 64.0574 101.499 69.5131 102.585C74.9688 103.67 80.6238 103.113 85.763 100.984C90.9021 98.8554 95.2947 95.2506 98.3851 90.6254C101.475 86.0003 103.125 80.5626 103.125 75C103.117 67.5432 100.152 60.394 94.8788 55.1212C89.606 49.8484 82.4568 46.8828 75 46.875ZM75 93.75C71.2916 93.75 67.6665 92.6504 64.5831 90.5901C61.4996 88.5298 59.0964 85.6015 57.6773 82.1753C56.2581 78.7492 55.8868 74.9792 56.6103 71.3421C57.3337 67.7049 59.1195 64.364 61.7417 61.7418C64.364 59.1195 67.7049 57.3338 71.3421 56.6103C74.9792 55.8868 78.7492 56.2581 82.1753 57.6773C85.6014 59.0964 88.5298 61.4997 90.59 64.5831C92.6503 67.6665 93.75 71.2916 93.75 75C93.75 79.9728 91.7745 84.742 88.2582 88.2583C84.7419 91.7746 79.9728 93.75 75 93.75ZM126.562 76.2657C126.586 75.4219 126.586 74.5781 126.562 73.7344L135.305 62.8125C135.763 62.2391 136.08 61.566 136.231 60.8475C136.382 60.1289 136.361 59.3851 136.172 58.6758C134.739 53.2887 132.595 48.1163 129.797 43.2949C129.431 42.664 128.922 42.1273 128.312 41.7275C127.701 41.3277 127.006 41.076 126.281 40.9922L112.383 39.4453C111.805 38.836 111.219 38.25 110.625 37.6875L108.984 23.7539C108.9 23.0286 108.647 22.333 108.247 21.7227C107.846 21.1123 107.308 20.604 106.676 20.2383C101.853 17.4454 96.6806 15.3037 91.2949 13.8692C90.5852 13.6805 89.8411 13.6612 89.1225 13.8128C88.404 13.9645 87.7311 14.2828 87.1582 14.7422L76.2656 23.4375H73.7344L62.8125 14.7129C62.239 14.2545 61.5659 13.9372 60.8474 13.7866C60.1289 13.636 59.385 13.6562 58.6758 13.8457C53.2895 15.2814 48.1175 17.4251 43.2949 20.2207C42.664 20.5871 42.1272 21.0957 41.7275 21.706C41.3277 22.3163 41.0759 23.0116 40.9922 23.7364L39.4453 37.6582C38.8359 38.2403 38.25 38.8262 37.6875 39.416L23.7539 41.0156C23.0286 41.1 22.333 41.3527 21.7226 41.7535C21.1123 42.1543 20.604 42.6922 20.2383 43.3242C17.4454 48.1475 15.3037 53.3194 13.8691 58.7051C13.6804 59.4148 13.6611 60.1589 13.8128 60.8775C13.9644 61.596 14.2828 62.2689 14.7422 62.8418L23.4375 73.7344V76.2657L14.7129 87.1875C14.2545 87.761 13.9372 88.4341 13.7866 89.1526C13.636 89.8711 13.6562 90.615 13.8457 91.3242C15.2788 96.7113 17.4227 101.884 20.2207 106.705C20.5871 107.336 21.0956 107.873 21.706 108.273C22.3163 108.672 23.0115 108.924 23.7363 109.008L37.6348 110.555C38.2168 111.164 38.8027 111.75 39.3926 112.313L41.0156 126.246C41.1 126.971 41.3527 127.667 41.7535 128.277C42.1543 128.888 42.6922 129.396 43.3242 129.762C48.1474 132.555 53.3194 134.696 58.7051 136.131C59.4148 136.32 60.1589 136.339 60.8774 136.187C61.596 136.036 62.2689 135.717 62.8418 135.258L73.7344 126.563C74.5781 126.586 75.4219 126.586 76.2656 126.563L87.1875 135.305C87.7609 135.763 88.434 136.08 89.1526 136.231C89.8711 136.382 90.6149 136.361 91.3242 136.172C96.7113 134.739 101.884 132.595 106.705 129.797C107.336 129.431 107.873 128.922 108.273 128.312C108.672 127.701 108.924 127.006 109.008 126.281L110.555 112.383C111.164 111.805 111.75 111.219 112.312 110.625L126.246 108.984C126.971 108.9 127.667 108.647 128.277 108.247C128.888 107.846 129.396 107.308 129.762 106.676C132.555 101.853 134.696 96.6806 136.131 91.2949C136.32 90.5852 136.339 89.8411 136.187 89.1226C136.036 88.404 135.717 87.7312 135.258 87.1582L126.562 76.2657ZM117.129 72.4571C117.229 74.1509 117.229 75.8491 117.129 77.543C117.059 78.7027 117.422 79.8469 118.148 80.7539L126.463 91.1426C125.509 94.1746 124.287 97.1159 122.812 99.9317L109.57 101.432C108.417 101.56 107.352 102.111 106.582 102.979C105.454 104.247 104.253 105.448 102.984 106.576C102.117 107.347 101.566 108.411 101.437 109.564L99.9668 122.795C97.1513 124.27 94.21 125.492 91.1777 126.445L80.7832 118.131C79.9514 117.466 78.9182 117.105 77.8535 117.105H77.5723C75.8784 117.205 74.1802 117.205 72.4863 117.105C71.3266 117.036 70.1824 117.399 69.2754 118.125L58.8574 126.445C55.8254 125.491 52.8841 124.27 50.0684 122.795L48.5684 109.57C48.4403 108.417 47.8892 107.352 47.0215 106.582C45.753 105.454 44.5517 104.253 43.4238 102.984C42.6535 102.117 41.5888 101.566 40.4355 101.438L27.2051 99.961C25.7296 97.1455 24.508 94.2042 23.5547 91.1719L31.8691 80.7774C32.5951 79.8704 32.9585 78.7261 32.8887 77.5664C32.7891 75.8726 32.7891 74.1743 32.8887 72.4805C32.9585 71.3208 32.5951 70.1765 31.8691 69.2696L23.5547 58.8574C24.5087 55.8254 25.7303 52.8842 27.2051 50.0684L40.4297 48.5684C41.5829 48.4404 42.6476 47.8892 43.418 47.0215C44.5458 45.753 45.7471 44.5517 47.0156 43.4239C47.8868 42.653 48.4402 41.5858 48.5684 40.4297L50.0391 27.2051C52.8545 25.7297 55.7958 24.508 58.8281 23.5547L69.2226 31.8692C70.1296 32.5952 71.2739 32.9585 72.4336 32.8887C74.1274 32.7891 75.8257 32.7891 77.5195 32.8887C78.6792 32.9585 79.8235 32.5952 80.7305 31.8692L91.1426 23.5547C94.1746 24.5088 97.1159 25.7304 99.9316 27.2051L101.432 40.4297C101.56 41.5829 102.111 42.6477 102.979 43.418C104.247 44.5459 105.448 45.7471 106.576 47.0156C107.346 47.8833 108.411 48.4345 109.564 48.5625L122.795 50.0332C124.27 52.8487 125.492 55.79 126.445 58.8223L118.131 69.2168C117.398 70.1314 117.034 71.2875 117.111 72.4571H117.129Z" fill="black"/>
                    </svg>
                    <h5 class="center-align" style="margin: 20px 0 20px 0;">Данных нет.</h5></div>';
                }
            
            ?>
        </div>


    </div>
</div>